<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta HTTP-EQUIV="EXPIRES" CONTENT="-1">
		<title>Computing Science 309 Warehouse Wars</title>
		<script language="javascript" src="jquery-3.1.1.min.js" > </script>
		<script language="javascript" src="ww.js" > </script>
		<link rel="stylesheet" type="text/css" href="style.css"></link>
	</head>
		<script> 
			stage=null;
			interval=null;
			score=0;
			function alertStuff(data){ alert(JSON.stringify(data)); }
			function setupGame(){
				stage=new Stage(20,20,"stage");
				stage.initialize();
			}
			function startGame(){
				if(interval == null){
					interval = setInterval(step, 1000);
				}
			}
			function pauseGame(){
				clearInterval(interval);
				interval=null;
			}

			function loginFunction(){
				var input = { "user": $("#loginuser").val(), "password": $("#loginpasswd").val(),
								"login": true};
				
				var params = {
                          method: "POST",
                          url: "api/api.php",
                          data: JSON.stringify(input),
                          contentType: 'application/json; charset=UTF-8',
                          dataType: "json"
                      };
				$.ajax(params).done(function(data){
					alert(data["status"]);
					if(data["status"] != "Success!"){
						$("#loginuser").css('background-color', 'red');
						$("#loginpasswd").css('background-color', 'red');
					} else {
						$("#LoginPage").hide();
                        setupGame();
                        startGame();
                        $("#game").show();
					}	
				});
			}
			function registerFunction(){
				var input = { "user": $("#registeruser").val(), "password": $("#registerpasswd").val(),
                                   "email": $("#registeremail").val()};
				var params = {
						method: "PUT",
						url: "api/api.php",
						data: JSON.stringify(input),
						contentType: 'application/json; charset=UTF-8',
						dataType: "json"
					};
				$.ajax(params).done(function(data){
					alert(data["status"]);
					if(data["status"] != "Success!"){
						$("#registeruser").css('background-color', 'red');
					} else {
						$("#RegisterPage").hide();
						setupGame();
						startGame();
						$("#game").show();
					}
				});
			}
			function movePlayer(direction){
				if(interval != null){
					stage.movePlayer(direction);
				}
			}
			function readKeyboard(event){

				if(interval != null){
					input = String.fromCharCode(event.keyCode);
					input = input.toLowerCase();

					if(input == "w") {
				    	stage.movePlayer("N");
				    }
				    if(input == "s") {
				    	stage.movePlayer("S");
				    }
				    if(input == "d") {
				    	stage.movePlayer("E");
				    }
				    if(input == "a") {
				    	stage.movePlayer("W");
				    }
				    if(input == "q") {
				    	stage.movePlayer("NW");
				    }
				    if(input == "e") {
				    	stage.movePlayer("NE");
				    }
				    if(input == "z") {
				    	stage.movePlayer("SW");
				    }
				    if(input == "c") {
				    	stage.movePlayer("SE");
				    }
					stage.step();
				}
			}
			function step(){
				stage.moveMonsters();
				stage.step();
				score++;
				$('#score').html(score);
			}

			$(function(){

				$('#LoginPage').show();
				$('#RegisterPage').hide();
				$('#game').hide();

				document.addEventListener('keydown', function(event) { readKeyboard(event); });

				$('#RegisterButton').click(function(){ 
					$('#LoginPage').hide();
					$('#RegisterPage').show(); 

				});
				$('#LoginButton').click(function(){
					loginFunction();
				});
				$('#submitRegister').click(function(){
					if($('#registeruser')[0].checkValidity() && $('#registerpasswd')[0].checkValidity() && $('#registeremail')[0].checkValidity()){
						registerFunction();
					}
				});
			});
		</script>
	</head>
	<body bgcolor="ffffff">
		<center>
			<h1>Warehouse Wars</h1>


			<div id="LoginPage">
				<h1>Login</h1>
				<form>
					<fieldset>

						<legend>Login</legend>

						<p> <label for="user">User</label><input id="loginuser" type="text" name="user" value="" required>
						<p> <label for="password">Password</label><input id="loginpasswd" type="password" name="password" required></p>

						<input id="LoginButton" type="button" value="Login"/>
						<input id="RegisterButton" type="button" value ="Register"/>
					<!--	<input id="ForgotButton" type="button" value ="Forgot Password"/> -->

					</fieldset>
				</form>	
			</div>

			<div id="RegisterPage">
				<h1>Registration</h1>
			    <form>
			        <fieldset>
			            <legend>Registration</legend>
			            <p><label for="user">User</label> <input id="registeruser" type="text" name="user" required>
			            <p><label for="password">Password</label><input id="registerpasswd" type="password" title="8 characters minimum. At lease one uppercase character and one number required." 
															pattern="^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d).{8,}$" name="password" required>
			            <p><label for="email">email</label><input id="registeremail" type="email" name="email" required>
			            <p><input id="submitRegister" type="button" value="Submit"/>
			        </fieldset>
				</form>
			</div>

			<div id="Hiscores">
				<h1>Hiscores</h1>
			</div>

			<div id="game">
			<table>
				<tr>
					<td> <div id="stage"> </div></td> 
					<td>
						<center>
							<h2>Score</h2> <div id="score"> &nbsp; </div>
							<h2>Legend</h2>
							<table class="legend">
								<tr>
									<td> <img src="icons/blank.gif" id="blankImage" /> </td>
									<td> <img src="icons/emblem-package-2-24.png" id="boxImage" /> </td>
									<td> <img src="icons/face-cool-24.png" id="playerImage" /> </td>
									<td> <img src="icons/face-devil-grin-24.png" id="monsterImage" /> </td>
									<td> <img src="icons/wall.jpeg" width="20px" height="20px" id="wallImage" /> </td>
								</tr>
								<tr>
									<td> Empty <br/> Square </td>
									<td> Box </td>
									<td> Player </td>
									<td> Monster </td>
									<td> Wall </td>
								</tr>
							</table>
							<h2>Controls</h2>
							<table class="controls">
								<tr>
									<td><img src="icons/north_west.svg" onclick=movePlayer('NW'); /></td>
									<td><img src="icons/north.svg" onclick=movePlayer('N'); /></td>
									<td><img src="icons/north_east.svg" onclick=movePlayer('NE'); /></td>
								</tr>
								<tr>
									<td><img src="icons/west.svg" onclick=movePlayer('W'); /></td>
									<td>&nbsp;</td>
									<td><img src="icons/east.svg" onclick=movePlayer('E'); /></td>
								</tr>
								<tr>
									<td><img src="icons/south_west.svg" onclick=movePlayer('SW'); /></td>
									<td><img src="icons/south.svg" onclick=movePlayer('S'); /></td>
									<td><img src="icons/south_east.svg" onclick=movePlayer('SE'); /></td>
								</tr>
							</table>
						</center>
					</td>
				</tr>
			</table>
		</div>
		</center>
	</body>
</html>

